{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="booking-page">

  <h1>Make a Reservation</h1>

  <!-- BOOKING FORM -->
  <section class="booking-form">
    <form method="get" novalidate>
      {% csrf_token %}

      <!-- {% if form.non_field_errors %}
        <div class="form-errors">
          {{ form.non_field_errors }}
        </div>
      {% endif %} -->
        <div class="form-row">
            {{ form.date.label_tag }}
            {{ form.date}}
        </div>

        <div class="form-row">
            {{ form.party_size.label_tag }}
            {{ form.party_size }}
        </div>

      {% for field in form %}
        {% if field.name != "date" and field.name != "party_size" and field.name != "allergies" %}
            <div class="form-row">
                {{ field.label_tag }}
                {{ field }}

                {% if field.errors %}
                    <div class="field-errors">
                        {{ field.errors }}
                    </div>
                {% endif %}
            </div>
        {% endif %}
      {% endfor %}
        
        <div class="form-row">
            {{ form.allergies.label_tag }}
            {{ form.allergies }}
        </div>

        <button type="submit" formmethod="post" class="btn-primary">
            Make Booking
        </button>
    </form>
  </section>

  <!-- MY BOOKINGS -->
  {% if my_bookings %}
    <section class="my-bookings">
      <h2>My Upcoming Bookings</h2>

      <ul class="booking-list">
        {% for booking in my_bookings %}
          <li class="booking-item">
            <div class="booking-details">
              <strong>{{ booking.start_time|date:"D d M Y" }}</strong>
              at {{ booking.start_time|time:"H:i" }}
              <br>
              Table {{ booking.table }}
              {% if booking.status == "CANCELLED" %}
                <span class="status cancelled">Cancelled</span>
              {% endif %}
            </div>

            <div class="booking-actions">
                <form
                    method="post"
                    action="{% url 'booking:cancel_booking' booking.id %}"
                    style="display:inline"
                    onsubmit="return confirm('Are you sure you want to cancel this booking?');"
                >
                    {% csrf_token %}
                    {% if booking.status != "CANCELLED" %}
                        <button type="submit">Cancel</button>
                    {% else %}
                        <p class="text-muted">
                            This booking has been cancelled and cannot be modified.
                        </p>
                    {% endif %}
                </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

</div>
{% endblock %}
