{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class='booking-page'>
  {% if editing %}
    <h1>Editing Booking</h1>
        <p>
      <strong>Reference:</strong> {{ form.instance.id }}
    </p>
    <p>
      <strong>Date:</strong>
      {{ form.instance.start_time|date:'F j, Y' }}
    </p>
    <p>
      <strong>Time:</strong>
      {{ form.instance.start_time|time:'H:i' }}
    </p>
    <p>
      <strong>Number of people:</strong>
      {{ form.instance.party_size }}
    </p>
  </div>
  {% else %}
    <h1>Make a Booking</h1>
  {% endif %}
  <!-- BOOKING FORM -->
  <section class='booking-form'>
    <form method='post'
          id='booking-form'
          {% if editing %}data-booking-id='{{ form.instance.id|default:"" }}'{% endif %}>
      {% csrf_token %}
      <div>
        <div>Date:</div>
        <div>{{ form.date }}</div>
      </div>
      <div>
        <div>Number of People:</div>
        <div>{{ form.party_size }}</div>
      </div>
      <div>
        <div>Time:</div>
        <div>{{ form.slot }}</div>
      </div>
      <div>
        <div>Allergies?:</div>
        <div>{{ form.allergies }}</div>
      </div>
      {{ form.non_field_errors }}

      {% for field in form %}
        {{ field.errors }}
      {% endfor %}
      <button type='submit'>
        {% if editing %}
          Amend booking
        {% else %}
          Make booking
        {% endif %}
      </button>
    </form>
 
  </section>

  <!-- MY BOOKINGS -->
  {% if past_bookings %}
    <section class='my-bookings'>
      <h2>My Past Bookings</h2>

      <ul class='booking-list'>
        {% for booking in past_bookings %}
          <li class='booking-item'>
            <div class='booking-details'>
              <strong>{{ booking.start_time|date:'D d M Y' }}</strong>
              at {{ booking.start_time|time:'H:i' }}
              <br>
              ({{ booking.party_size }} people)
              {% if booking.status == 'CANCELLED' %}
                <span class='status cancelled'>--Cancelled--</span>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% if upcoming_bookings %}
    <section class='my-bookings'>
      <h2>My Upcoming Bookings</h2>

      <ul class='booking-list'>
        {% for booking in upcoming_bookings %}
          <li class='booking-item'>
            <div class='booking-details'>
              <strong>{{ booking.start_time|date:'D d M Y' }}</strong>
              at {{ booking.start_time|time:'H:i' }}
              <br>
              ({{ booking.party_size }} people)
              {% if booking.status == 'CANCELLED' %}
                <span class='status cancelled'>--Cancelled--</span>
              {% endif %}
            </div>

            <div class='booking-actions'>
                
                {% if booking.status != 'CANCELLED' %}
                  <a href='{% url "booking:edit_booking" booking.id %}'>Edit</a>
                {% endif %}
                
                <form
                    method='post'
                    action='{% url "booking:cancel_booking" booking.id %}'
                    style='display:inline'
                    onsubmit='return confirm("Are you sure you want to cancel this booking?");'
                >
                    {% csrf_token %}
                    {% if booking.status != 'CANCELLED' %}
                        <button type='submit'>Cancel</button>
                    {% else %}
                        <p class='text-muted'>
                            This booking has been cancelled and cannot be modified.
                        </p>
                    {% endif %}
                </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}
</div>
{% endblock %}
{% block extras %}
<script src='{% static "js/available_slots.js" %}'></script>
{% endblock %}